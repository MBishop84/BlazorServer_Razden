@page "/"
@using Newtonsoft.Json;
@using Transformer_.Data.Animations;

<PageTitle>Home</PageTitle>

<RadzenStack AlignItems="AlignItems.Center">
    <Animation AnimationName=@AnimationName.fade>
        <img src="/images/stoic-strategist.png" style="height: 300px" alt="stoic"/>
    </Animation>
    <RadzenText TextStyle="TextStyle.Subtitle1">@quote</RadzenText>
    <RadzenText TextStyle="TextStyle.Subtitle2">@author</RadzenText>
    <RadzenButton Variant="Variant.Outlined" Shade="Shade.Darker" Click="@GetContent" Text="Refresh Quote" ButtonStyle="ButtonStyle.Info"/>
    <RadzenButton Variant="Variant.Outlined" Shade="Shade.Darker" Click="@Fly" Text="Fly By" ButtonStyle="ButtonStyle.Info"/>
</RadzenStack>
 @if (flyBy)
{
    <Animation AnimationName=@AnimationName.zoomIn AnimationDuration="2000">
        <Animation AnimationName=@AnimationName.zoomOut AnimationDuration="2000" AnimationDelay="2000">
            <img src="/images/Autobots.png" alt="stoic"/>
        </Animation>
    </Animation>
}

@code {
    private string quote = "Seeking Wisdom...";
    private string author = "...";
    private bool flyBy { get; set; }

    private struct Content
    {
        public string Quote { get; set; }
        public string Author { get; set; }
    }

    protected override async Task OnInitializedAsync()
        => await GetContent();

    private async Task GetContent()
    {
        quote = "Seeking Wisdom...";
        await Task.Delay(1000);
        using var client = new HttpClient();
        var response = await client.GetAsync("https://api.themotivate365.com/stoic-quote");
        if (response.IsSuccessStatusCode)
        {
            var json = await response.Content.ReadAsStringAsync();
            var content = JsonConvert.DeserializeObject<Content>(json);
            quote = content.Quote;
            author = content.Author;
        }
    }

    private async Task Fly()
    {
        flyBy = true;
        await Task.Delay(2000);
        flyBy = false;
    }
}
